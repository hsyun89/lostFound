<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="LostMapper">
	<sql id="categorySearch">
		<if test="category !=null">
			<if test="category != 'all'.toString()">
				and category like CONCAT('%', #{category},'%')
			</if>
		</if>
	</sql>
	<sql id="placeSearch">
		<if test="place !=null">
			<if test="place != 'all'.toString()" >
				<if test="place != ''.toString()" >
				and find_place = #{place}
				</if>
			</if>
		</if>
	<!-- 	<if test="place ==null"></if> -->
	</sql>
	<sql id="search">
<!-- 		<if test="searchType !=null"> -->
			<if test="searchType == 'all'.toString()">
				and (
				unique_id like CONCAT('%', #{keyword}, '%')
				OR
				product_name like CONCAT('%', #{keyword}, '%')
				OR
				keep_place like
				CONCAT('%', #{keyword}, '%')
				OR
				find_date like CONCAT('%', #{keyword},'%')
				OR
				find_place like CONCAT('%', #{keyword}, '%')
				)
			</if>

			<if test="searchType == 'product_name'.toString()">
				and product_name like CONCAT('%', #{keyword}, '%')
			</if>

			<if test="searchType == 'keep_place'.toString()">
				and keep_place like CONCAT('%', #{keyword}, '%')
			</if>

			<if test="searchType == 'find_date'.toString()">
				and find_date like CONCAT('%', #{keyword}, '%')
			</if>

			<if test="searchType == 'find_place'.toString()">
				and find_place like CONCAT('%', #{keyword}, '%')
			</if>

	<!-- 	</if> -->
	</sql>
	<select id="listMainSearch" resultType="vo.LostVO">
		select addr, unique_id,
		content, keep_place, image_address,
		product_name,
		find_date, category,
		find_place from
		lost where product_name like CONCAT('%', #{keyword},
		'%')
		order by find_date desc limit #{pageStart}, #{perPageNum}
	</select>

	<select id="listPageSearch" resultType="vo.LostVO">
		select addr, unique_id, content, keep_place, image_address,
		product_name,
		find_date, category, find_place from lost where unique_id
		is not null
		<include refid="categorySearch"></include>
		<include refid="search"></include>
		<include refid="placeSearch"></include>
		order by Find_date desc limit #{pageStart},#{perPageNum}
	</select>

	<select id="listPageCount" resultType="int">
		select count(unique_id) from lost where unique_id is not null
		<include refid="search"></include>
	</select>

	<insert id="insertLost" parameterType="vo.LostVO">
		replace into lost (addr,
		unique_id, content, keep_place, image_address, product_name,
		find_date, category, find_place) values (#{addr}, #{unique_id},
		#{content}, #{keep_place}, #{image_address}, #{product_name},
		#{find_date}, #{category}, #{find_place})
	</insert>
</mapper>