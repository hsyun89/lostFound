<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="resource.AuctionMapper">
	<!--전체리스트 -->
	<select id="auctionlistAll" resultType="vo.ListVO">
		SELECT LOST.UNIQUE_ID, IMAGE_ADDRESS, PRODUCT_NAME, CATEGORY, START_PRICE, MIN_BID, date_format(START_DATE, '%Y-%m-%d-%p-%h-%i') START_DATE, date_format(END_DATE, '%Y-%m-%d-%p-%h-%i')END_DATE FROM AUCTION, LOST
		 WHERE auction.unique_id = lost.unique_id;
	</select>
	<!--경매 상세페이지 -->
	<select id="auctionOne" resultType="vo.ListVO" parameterType="string">
		SELECT LOST.UNIQUE_ID, IMAGE_ADDRESS, PRODUCT_NAME, CATEGORY, START_PRICE, MIN_BID, START_DATE, END_DATE FROM AUCTION, LOST
		 WHERE auction.unique_id = lost.unique_id AND lost.unique_id = #{productId};
	</select>
	
	<!--카테고리-->
	<select id="category" resultType="vo.ListVO" parameterType="string">
 		SELECT LOST.UNIQUE_ID, IMAGE_ADDRESS, PRODUCT_NAME, CATEGORY, START_PRICE, MIN_BID, date_format(START_DATE, '%Y-%m-%d') START_DATE, date_format(END_DATE, '%Y-%m-%d')END_DATE FROM AUCTION, LOST 
 		WHERE AUCTION.UNIQUE_ID = LOST.UNIQUE_ID AND LOST.CATEGORY LIKE CONCAT('%', #{KEY},'%');
 	</select>
 	
	<!--경매 추가-->
	<insert id="insertAuction" parameterType="vo.AuctionVO">
		INSERT INTO AUCTION(UNIQUE_ID, START_PRICE, MIN_BID, START_DATE, END_DATE)
		VALUES(#{unique_id},#{start_price},#{min_bid}, #{start_date}, #{end_date});
	</insert>
	
	<!--경매 입찰 내역 인서트-->
	<insert id="insertAuctionLog" parameterType="vo.AuctionLogVO">
		INSERT INTO AUCTION_LOG(UNIQUE_ID, USER_ID, PRICE, BID_DATE)
		VALUES(#{unique_id}, #{user_id}, #{price}, #{bid_date});
	</insert>
	
	<!--경매 입찰자, 최고입찰가 확인-->
	<select id="selectMaxPriceAndUser" resultType="vo.AuctionLogVO" parameterType="string">
 		SELECT unique_id, user_id, MAX(price) price, bid_date FROM auction_log WHERE unique_id = #{unique_id};
 	</select>
 	
 	<!--경매 입찰 내역 다 뽑기-->
	<select id="selectBiddingList" resultType="vo.AuctionLogVO" parameterType="string">
 		SELECT unique_id, user_id, price, bid_date FROM auction_log WHERE unique_id = #{productId} order by bid_date desc;
 	</select>
 	
 	<!--경매 낙찰 시간 연장-->
	<update id="plusEndTime" parameterType="vo.AuctionVO">
	UPDATE auction SET end_date = #{end_date} WHERE unique_id = #{unique_id};
	</update>
</mapper>
  
  